var __awaiter=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r.throw(n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t)).next())})},BingSpeech;(function(n){var r,t;(function(n){n[n.Raw8khz8bit=0]="Raw8khz8bit";n[n.Raw16khz16bit=1]="Raw16khz16bit";n[n.Riff8khz8bit=2]="Riff8khz8bit";n[n.Riff16khz16bit=3]="Riff16khz16bit"})(n.OutputFormat||(n.OutputFormat={}));r=n.OutputFormat,function(n){n[n.arEG_Female=0]="arEG_Female";n[n.deDE_Female=1]="deDE_Female";n[n.deDE_Male=2]="deDE_Male";n[n.enAU_Female=3]="enAU_Female";n[n.enCA_Female=4]="enCA_Female";n[n.enGB_Female=5]="enGB_Female";n[n.enGB_Male=6]="enGB_Male";n[n.enIN_Male=7]="enIN_Male";n[n.enUS_Female=8]="enUS_Female";n[n.enUS_Male=9]="enUS_Male";n[n.esES_Female=10]="esES_Female";n[n.esES_Male=11]="esES_Male";n[n.esMX_Male=12]="esMX_Male";n[n.frCA_Female=13]="frCA_Female";n[n.frFR_Female=14]="frFR_Female";n[n.frFR_Male=15]="frFR_Male";n[n.itIT_Male=16]="itIT_Male";n[n.jaJP_Female=17]="jaJP_Female";n[n.jaJP_Male=18]="jaJP_Male";n[n.ptBR_Male=19]="ptBR_Male";n[n.ruRU_Female=20]="ruRU_Female";n[n.ruRU_Male=21]="ruRU_Male";n[n.zhCN_Female=22]="zhCN_Female";n[n.zhCN_Female2=23]="zhCN_Female2";n[n.zhCN_Male=24]="zhCN_Male";n[n.zhHK_Female=25]="zhHK_Female";n[n.zhHK_Male=26]="zhHK_Male";n[n.zhTW_Female=27]="zhTW_Female";n[n.zhTW_Male=28]="zhTW_Male";n[n.enIn_Female=29]="enIn_Female"}(n.SupportedLocales||(n.SupportedLocales={}));t=n.SupportedLocales;class u{constructor(n,t){if(this.authToken="",this._issueTokenUrl=t,this.canUseWebAudio=!1,!n)throw"Please provide a valid Bing Speech API key";this.apiKey=n;try{(typeof AudioContext!="undefined"||typeof webkitAudioContext!="undefined")&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioContext=new AudioContext,this.canUseWebAudio=!0,/iPad|iPhone|iPod/.test(navigator.platform)&&this._unlockiOSaudio())}catch(i){console.error("Cannot initialize Web Audio Context.")}}_unlockiOSaudio(){var n=()=>{var i=this.audioContext.createBuffer(1,1,22050),t=this.audioContext.createBufferSource();t.buffer=i;t.connect(this.audioContext.destination);t.start(0);setTimeout(()=>{(t.playbackState===t.PLAYING_STATE||t.playbackState===t.FINISHED_STATE)&&window.removeEventListener("touchend",n,!1)},0)};window.addEventListener("touchend",n,!1)}checkAuthToken(){return __awaiter(this,void 0,void 0,function*(){var r=(Date.now()-this._tokenTime)/1e3,n,t,i;if(this.authToken===""||r>500){n="";t=[{name:"Ocp-Apim-Subscription-Key",value:this.apiKey},{name:"Access-Control-Allow-Origin",value:"*"}];try{i=yield this.makeHttpRequest("POST",this._issueTokenUrl,!1,t);n=i;this._tokenTime=Date.now();console.log("New authentication token generated.")}catch(u){console.error("Error issuing token. Did you provide a valid Bing Speech API key?")}this.authToken=n}})}makeHttpRequest(n,t,i=false,r,u){return __awaiter(this,void 0,void 0,function*(){return new Promise((f,e)=>{var o=new XMLHttpRequest;i&&(o.responseType="arraybuffer");o.onreadystatechange=function(){o.readyState===4&&(o.status>=200&&o.status<300?i?f(o.response):f(o.responseText):e(o.status))};try{o.open(n,t,!0);r&&r.forEach(n=>{o.setRequestHeader(n.name,n.value)});u?o.send(u):o.send()}catch(s){e(s)}})})}}class i{static generateString(){return i.getRnd4HexOctet()+i.getRnd4HexOctet()+"-"+i.getRnd4HexOctet()+"-"+i.getRndGuidTimeHiAndVersionHex()+"-"+i.getRndGuidClockSeqHiAndReservedHex()+"-"+i.getRnd4HexOctet()+i.getRnd4HexOctet()+i.getRnd4HexOctet()}static generate16bitRnd(){return Math.random()*65536|0}static getRnd4HexOctet(){return("0000"+i.generate16bitRnd().toString(16)).slice(-4)}static getRndGuidTimeHiAndVersionHex(){return(i.generate16bitRnd()&4095|16384).toString(16)}static getRndGuidClockSeqHiAndReservedHex(){return(i.generate16bitRnd()&16383|32768).toString(16)}}class f{constructor(n,t="en-IN"){if(this._actualRequests=[],this._waitingForAnswers=!1,this._vad=null,this._continuous=!1,this._audioStream=null,this._locale="en-IN",!n)throw"Please provide a valid Bing Speech API key";if(this._tools=new u(n),this._locale=t,navigator.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia,!navigator.getUserMedia)throw"Sorry, your browser doesn't have microphone support.";}startMicAndContinuousRecognition(){typeof VADRecord!="undefined"?this._continuous||(this._continuous=!0,this._continueListening()):console.warn("You need to reference vadrecord.js")}endMicAndContinuousRecognition(){this._continuous=!1;this._audioStream&&this._audioStream.getAudioTracks()[0].stop();this.onVoiceEnded&&this.onVoiceEnded();this.onNetworkActivityEnded&&this.onNetworkActivityEnded();this._vad&&this._vad.dispose()}_continueListening(){navigator.getUserMedia({audio:!0},n=>{this._startVoiceDetection(n)},function(n){console.log("No live audio input in this browser: "+n)})}_startVoiceDetection(n){this._audioStream=n;var t=this._tools.audioContext.createMediaStreamSource(n),i={source:t,voice_stop:n=>{this.onVoiceEnded&&this.onVoiceEnded(),this.recognizeAudio(n,this._locale)},voice_start:()=>{this.onVoiceDetected&&this.onVoiceDetected()}};this._vad=new window.VADRecord(i)}recognizeAudio(n){return __awaiter(this,void 0,void 0,function*(){var t=i.generateString(),l={hasBeenProcessed:!1,requestId:t,text:"",error:!1},e,o,u,f,s,h,r;this._actualRequests.push(l);this.onNetworkActivityStarted&&this.onNetworkActivityStarted();yield this._tools.checkAuthToken();f=!1;e=[{name:"Content-type",value:"audio/wav; samplerate=16000"},{name:"Authorization",value:"Bearer "+this._tools.authToken}];try{s=new Blob([n],{type:"audio/wav"});h="?scenarios=smd&appid=D4D52672-91D7-4C74-8AD8-42B1D98141A5&locale="+this._locale+"&device.os=wp7&version=3.0&format=json&instanceid=b2c95ede-97eb-4c88-81e4-80f32d6aee54&requestid="+t;o=yield this._tools.makeHttpRequest("POST","https://speech.platform.bing.com/recognize"+h,!1,e,s);r=JSON.parse(o);r.header&&r.header.status!=="error"?u=r.header.name:(f=!0,u="!Error during recognition!");let i=0;for(i=0;i<this._actualRequests.length;i++)if(this._actualRequests[i].requestId===t){this._actualRequests[i].text=u;this._actualRequests[i].hasBeenProcessed=!0;this._actualRequests[i].error=f;break}i!==0||this._waitingForAnswers||(this._waitingForAnswers=!0,this._returnAnswer())}catch(c){console.warn("Error while calling Bing Speech Recognition API: "+c);let n=0;for(n=0;n<this._actualRequests.length;n++)if(this._actualRequests[n].requestId===t)break;if(this._actualRequests.splice(n,1),this.onError)this.onError(c,t)}})}_returnAnswer(){var n=this._actualRequests[0];if(n){if(!n.hasBeenProcessed){window.setTimeout(()=>{this._returnAnswer()},100);return}if(this.onFinalResponseReceived&&!n.error)this.onFinalResponseReceived(n.text);if(this.onError&&n.error)this.onError(n.text,n.requestId);this._actualRequests.splice(0,1);this._actualRequests.length>0?this._returnAnswer():(this.onNetworkActivityEnded&&this.onNetworkActivityEnded(),this._waitingForAnswers=!1)}}}n.RecognitionClient=f;class e{constructor(n,i,r,f=t.enIn_Female){if(this.multipleXHR=!0,this._waitingQueue=[],this._waitingQueueIndex=[],this._nbWaitingItems=0,this._requestsInProgress=0,!n)throw"Please provide a valid Bing Speech API key";this._tools=new u(n,i);this._globalLocale=f;this._cognitiveServiceUrl=r;this._tools.checkAuthToken()}synthesize(n,t,i,u=r.Riff24Khz16BitMonoPcm){return __awaiter(this,void 0,void 0,function*(){if(!this._tools.canUseWebAudio){console.error("You need Web Audio to use this API.");return}let r=this._nbWaitingItems;this._nbWaitingItems++;var f={isReadyToPlay:!1,data:null,index:r,text:n,locale:t,outputFormat:u,callback:i};this._waitingQueue.push(f);this._waitingQueueIndex.push(r);(this.multipleXHR||this._requestsInProgress==0)&&this._getBingSpeechData(n,t,u,r)})}_getBingSpeechData(n,t,i,r){return __awaiter(this,void 0,void 0,function*(){var o,s,h,e;this._requestsInProgress++;yield this._tools.checkAuthToken();s=this._getFormatValue(i);o=[{name:"Content-type",value:"application/ssml+xml"},{name:"X-Microsoft-OutputFormat",value:s},{name:"Authorization",value:this._tools.authToken},{name:"X-Search-AppIde",value:"07D3234E49CE426DAA29772419F436CA"},{name:"X-Search-ClientID",value:"1ECFAE91408841A480F00935DC390960"},{name:"Ocp-Apim-Subscription-Key",value:this._tools.apiKey},{name:"Access-Control-Allow-Origin",value:"*"}];h=this.makeSSML(n,t);try{console.warn("_getBingSpeechData_1");e=yield this._tools.makeHttpRequest("POST",this._cognitiveServiceUrl,!0,o,h);console.warn("ToDate:-"+dateTime);console.warn("_getBingSpeechData_2")}catch(c){console.warn("Error while calling Bing Speech API. Ignoring this item: '"+n+"'")}this._requestsInProgress--;let f=this._waitingQueueIndex.indexOf(r),u=f+1;e?(this._waitingQueue[f].data=e,this._waitingQueue[f].isReadyToPlay=!0):(this._waitingQueue.splice(f,1),this._waitingQueueIndex.splice(f,1),u--);console.warn("nextIndex:-"+u);console.warn("_waitingQueue.length:-"+this._waitingQueue.length);!this.multipleXHR&&u<this._waitingQueue.length&&this._getBingSpeechData(this._waitingQueue[u].text,this._waitingQueue[u].locale,this._waitingQueue[u].outputFormat,this._waitingQueue[u].index);this._playing||this._play()})}_stop(){this._playing&&(this._tools.audioContext.close(),this._playing=!1,this._nbWaitingItems=0,this._waitingQueue.splice(0,this._waitingQueue.length),this._waitingQueueIndex.splice(0,this._waitingQueueIndex.length),this._tools.audioContext=new AudioContext)}_play(){var n=this._waitingQueue[0];if(n){if(!n.isReadyToPlay){window.setTimeout(()=>{this._play()},100);return}this._playing||(this._playing=!0,this._tools.audioContext.decodeAudioData(n.data,t=>{var i=this._tools.audioContext.createBufferSource();i.buffer=t;i.connect(this._tools.audioContext.destination);i.start(0);i.onended=()=>{this._playing=!1,this._waitingQueue.splice(0,1),this._waitingQueueIndex.splice(0,1),n.callback&&n.callback(),this._waitingQueue.length>0?this._play():this._nbWaitingItems=0}}))}}_getFormatValue(n){var t;switch(n){case r.Raw16khz16bit:t="raw-16khz-16bit-mono-pcm";break;case r.Raw8khz8bit:t="raw-8khz-8bit-mono-mulaw";break;case r.Riff16khz16bit:t="riff-16khz-16bit-mono-pcm";break;case r.Riff8khz8bit:t="riff-8khz-8bit-mono-mulaw";break;default:t="riff-16khz-16bit-mono-pcm"}return t}makeSSML(n,i){var r,u,f;i||(i=this._globalLocale);switch(i){case t.arEG_Female:r="'ar-eg'";u="'Female'";f="Microsoft Server Speech Text to Speech Voice (ar-EG, Hoda)";break;case t.deDE_Female:r="'de-de'";u="'Female'";f="Microsoft Server Speech Text to Speech Voice (de-DE, Hedda)";break;case t.deDE_Male:r="'de-de'";u="'Male'";f="Microsoft Server Speech Text to Speech Voice (de-DE, Stefan, Apollo)";break;case t.enAU_Female:r="'en-au'";u="'Female'";f="Microsoft Server Speech Text to Speech Voice (en-AU, Catherine)";break;case t.enCA_Female:r="'en-ca'";u="'Female'";f="Microsoft Server Speech Text to Speech Voice (en-CA, Linda)";break;case t.enGB_Female:r="'en-gb'";u="'Female'";f="Microsoft Server Speech Text to Speech Voice (en-GB, Susan, Apollo)";break;case t.enGB_Male:r="'en-gb'";u="'Male'";f="Microsoft Server Speech Text to Speech Voice (en-GB, George, Apollo)";break;case t.enIN_Male:r="'en-in'";u="'Male'";f="Microsoft Server Speech Text to Speech Voice (en-IN, Ravi, Apollo)";break;case t.enUS_Female:r="'en-us'";u="'Female'";f="Microsoft Server Speech Text to Speech Voice (en-US, ZiraRUS)";break;case t.enUS_Male:r="'en-us'";u="'Male'";f="Microsoft Server Speech Text to Speech Voice (en-US, BenjaminRUS)";break;case t.esES_Female:r="'es-es'";u="'Female'";f="Microsoft Server Speech Text to Speech Voice (es-ES, Laura, Apollo)";break;case t.esES_Male:r="'es-es'";u="'Male'";f="Microsoft Server Speech Text to Speech Voice (es-ES, Pablo, Apollo)";break;case t.esMX_Male:r="'es-mx'";u="'Male'";f="Microsoft Server Speech Text to Speech Voice (es-MX, Raul, Apollo)";break;case t.frCA_Female:r="'fr-ca'";u="'Female'";f="Microsoft Server Speech Text to Speech Voice (fr-CA, Caroline)";break;case t.frFR_Female:r="'fr-fr'";u="'Female'";f="Microsoft Server Speech Text to Speech Voice (fr-FR, Julie, Apollo)";break;case t.frFR_Male:r="'fr-fr'";u="'Male'";f="Microsoft Server Speech Text to Speech Voice (fr-FR, Paul, Apollo)";break;case t.itIT_Male:r="'it-it'";u="'Male'";f="Microsoft Server Speech Text to Speech Voice (it-IT, Cosimo, Apollo)";break;case t.jaJP_Female:r="'ja-jp'";u="'Female'";f="Microsoft Server Speech Text to Speech Voice (ja-JP, Ayumi, Apollo)";break;case t.jaJP_Male:r="'ja-jp'";u="'Male'";f="Microsoft Server Speech Text to Speech Voice (ja-JP, Ichiro, Apollo)";break;case t.ptBR_Male:r="'pt-br'";u="'Male'";f="Microsoft Server Speech Text to Speech Voice (pt-BR, Daniel, Apollo)";break;case t.ruRU_Female:r="'ru-ru'";u="'Female'";f="Microsoft Server Speech Text to Speech Voice (ru-RU, Irina, Apollo)";break;case t.ruRU_Male:r="'ru-ru'";u="'Male'";f="Microsoft Server Speech Text to Speech Voice (ru-RU, Pavel, Apollo)";break;case t.zhCN_Female:r="'zh-cn'";u="'Female'";f="Microsoft Server Speech Text to Speech Voice (zh-CN, HuihuiRUS)";break;case t.zhCN_Female2:r="'zh-cn'";u="'Female'";f="Microsoft Server Speech Text to Speech Voice (zh-CN, Yaoyao, Apollo)";break;case t.zhCN_Male:r="'zh-cn'";u="'Male'";f="Microsoft Server Speech Text to Speech Voice (zh-CN, Kangkang, Apollo)";break;case t.zhHK_Female:r="'zh-hk'";u="'Female'";f="Microsoft Server Speech Text to Speech Voice (zh-HK, Tracy, Apollo)";break;case t.zhHK_Male:r="'zh-hk'";u="'Male'";f="Microsoft Server Speech Text to Speech Voice (zh-HK, Danny, Apollo)";break;case t.zhTW_Female:r="'zh-tw'";u="'Female'";f="Microsoft Server Speech Text to Speech Voice (zh-TW, Yating, Apollo)";break;case t.zhTW_Male:r="'zh-tw'";u="'Male'";f="Microsoft Server Speech Text to Speech Voice (zh-TW, Zhiwei, Apollo)";break;case t.enIN_Female:r="'en-IN'";u="'Female'";f="Microsoft Server Speech Text to Speech Voice (en-IN, PriyaRUS)";break;default:r="'en-IN'";u="'Female'";f="Microsoft Server Speech Text to Speech Voice (en-IN, PriyaRUS)"}return"<speak version='1.0' xml:lang="+(r+"><voice xml:lang="+r+" xml:gender="+u+" name='"+f+"'>"+`${n.encodeHTML()}`+"<\/voice><\/speak>")}}n.TTSClient=e})(BingSpeech||(BingSpeech={}));String.prototype.encodeHTML||(String.prototype.encodeHTML=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}),function(n){var t=function(n){function l(n,t,i,r){for(var f,e=new Float32Array(t-i),o=0,s=n.length,h=i/r,u=h;u<s;u++)f=n[u],e.set(f,o),o+=f.length;return e}function a(n,t){let f=n.length+t.length,i=new Float32Array(f),r=0,u=0;while(r<f)i[r++]=n[u],i[r++]=t[u],u++;return i}function v(n,t,i){for(let r=0;r<i.length;r++,t+=2){let u=Math.max(-1,Math.min(1,i[r]));n.setInt16(t,u<0?u*32768:u*32767,!0)}}function y(n){var r=new ArrayBuffer(44+n.length*2);let i=new DataView(r);return e(i,0,"RIFF"),i.setUint32(4,36+n.length*2,!0),e(i,8,"WAVE"),e(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,t,!0),i.setUint32(24,s,!0),i.setUint32(28,s*4,!0),i.setUint16(32,t*2,!0),i.setUint16(34,16,!0),e(i,36,"data"),i.setUint32(40,n.length*2,!0),v(i,44,n),r}function h(){u=0;f=[];p()}function p(){for(let n=0;n<t;n++)f[n]=[]}function e(n,t,i){for(let r=0;r<i.length;r++)n.setUint8(t+r,i.charCodeAt(r))}var r=0,u=0,f=[],t=2,s=null,o,c,i;this.dispose=function(){this.options.source&&this.options.source.disconnect();this.analyser&&this.analyser.disconnect();this.scriptProcessorNode&&(this.scriptProcessorNode.onaudioprocess=null,this.scriptProcessorNode.disconnect());this.options.source=null;this.analyser=null;this.scriptProcessorNode=null};this.buildAudioRecord=function(){var i;let n=[];for(let i=0;i<t;i++)n.push(l(f[i],u,r,this.options.bufferLen));return i=t===2?a(n[0],n[1]):n[0],y(i)};this.options={fftSize:512,bufferLen:512,voice_stop:function(){},voice_start:function(){},smoothingTimeConstant:.99,energy_offset:1e-8,energy_threshold_ratio_pos:2,energy_threshold_ratio_neg:.5,energy_integration:1,filter:[{f:200,v:0},{f:2e3,v:1}],source:null,context:null};for(o in n)n.hasOwnProperty(o)&&(this.options[o]=n[o]);if(h(),!this.options.source)throw new Error("The options must specify a MediaStreamAudioSourceNode.");this.options.context=this.options.source.context;this.hertzPerBin=this.options.context.sampleRate/this.options.fftSize;this.iterationFrequency=this.options.context.sampleRate/this.options.bufferLen;this.iterationPeriod=1/this.iterationFrequency;s=this.options.context.sampleRate;c=!1;c&&console.log("Vad | sampleRate: "+this.options.context.sampleRate+" | hertzPerBin: "+this.hertzPerBin+" | iterationFrequency: "+this.iterationFrequency+" | iterationPeriod: "+this.iterationPeriod);this.setFilter=function(n){var t,r,i,u;for(this.filter=[],t=0,r=this.options.fftSize/2;t<r;t++)for(this.filter[t]=0,i=0,u=n.length;i<u;i++)if(t*this.hertzPerBin<n[i].f){this.filter[t]=n[i].v;break}};this.setFilter(this.options.filter);this.ready={};this.vadState=!1;this.energy_offset=this.options.energy_offset;this.energy_threshold_pos=this.energy_offset*this.options.energy_threshold_ratio_pos;this.energy_threshold_neg=this.energy_offset*this.options.energy_threshold_ratio_neg;this.voiceTrend=0;this.voiceTrendMax=10;this.voiceTrendMin=-10;this.voiceTrendStart=5;this.voiceTrendEnd=-5;this.analyser=this.options.context.createAnalyser();this.analyser.smoothingTimeConstant=this.options.smoothingTimeConstant;this.analyser.fftSize=this.options.fftSize;this.floatFrequencyData=new Float32Array(this.analyser.frequencyBinCount);this.floatFrequencyDataLinear=new Float32Array(this.floatFrequencyData.length);this.options.source.connect(this.analyser);this.scriptProcessorNode=this.options.context.createScriptProcessor(this.options.bufferLen,t,t);this.scriptProcessorNode.connect(this.options.context.destination);i=this;this.scriptProcessorNode.onaudioprocess=function(n){i.analyser.getFloatFrequencyData(i.floatFrequencyData);i.update();i.store(n);i.monitor()};this.options.source.connect(this.scriptProcessorNode);this.logging=!1;this.log_i=0;this.log_limit=100;this.triggerLog=function(n){this.logging=!0;this.log_i=0;this.log_limit=typeof n=="number"?n:this.log_limit};this.log=function(n){this.logging&&this.log_i<this.log_limit?(this.log_i++,console.log(n)):this.logging=!1};this.store=function(n){for(var i=0;i<t;i++)f[i].push(new Float32Array(n.inputBuffer.getChannelData(i)));u+=this.options.bufferLen};this.update=function(){for(var t=this.floatFrequencyData,n=0,i=t.length;n<i;n++)this.floatFrequencyDataLinear[n]=Math.pow(10,t[n]/10);this.ready={}};this.getEnergy=function(){var t,i,n,r;if(this.ready.energy)return this.energy;for(t=0,i=this.floatFrequencyDataLinear,n=0,r=i.length;n<r;n++)t+=this.filter[n]*i[n]*i[n];return this.energy=t,this.ready.energy=!0,t};this.monitor=function(){var e=this.getEnergy(),n=e-this.energy_offset,f,t,i,o;return n>this.energy_threshold_pos?this.voiceTrend=this.voiceTrend+1>this.voiceTrendMax?this.voiceTrendMax:this.voiceTrend+1:n<-this.energy_threshold_neg?this.voiceTrend=this.voiceTrend-1<this.voiceTrendMin?this.voiceTrendMin:this.voiceTrend-1:this.voiceTrend>0?this.voiceTrend--:this.voiceTrend<0&&this.voiceTrend++,f=!1,t=!1,this.voiceTrend>this.voiceTrendStart?f=!0:this.voiceTrend<this.voiceTrendEnd&&(t=!0),i=n*this.iterationPeriod*this.options.energy_integration,this.energy_offset+=i>0||!t?i:i*10,this.energy_offset=this.energy_offset<0?0:this.energy_offset,this.energy_threshold_pos=this.energy_offset*this.options.energy_threshold_ratio_pos,this.energy_threshold_neg=this.energy_offset*this.options.energy_threshold_ratio_neg,f&&!this.vadState&&(this.vadState=!0,r=u-this.options.bufferLen*128,r<0&&(r=0),this.options.voice_start()),t&&this.vadState&&(this.vadState=!1,o=this.buildAudioRecord(),h(),this.options.voice_stop(o)),this.log("e: "+e+" | e_of: "+this.energy_offset+" | e+_th: "+this.energy_threshold_pos+" | e-_th: "+this.energy_threshold_neg+" | signal: "+n+" | int: "+i+" | voiceTrend: "+this.voiceTrend+" | start: "+f+" | end: "+t),n}};n.VADRecord=t}(window)